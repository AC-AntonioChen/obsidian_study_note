## 1 Redis
### 1.1 redis对象
#### 1.1.1 set一个已有的数据会发生什么
会覆盖原有的值，同时会覆盖或者擦除键的过期时间。
#### 1.1.2 浮点型在string中用什么表示
对象类型上用String表示，底层数据结构使用embstr或raw编码格式
#### 1.1.3 string可以有多大
512mb。redis 设计上并不是为了存储大文件的，大文件会影响到持久化和网络通信效率，因此人为设置了这个上限值
#### redis字符串是怎么实现的
对象类型String ，通常有三种底层数据结构（encoding），int，embstr和raw格式。
当字符串内容为小于long可表示范围的整形数字时，采取int结构
当字符串内容小于等于44字节时，采取embstr结构，此时，描述字符串信息的redisobject和存储内容的sds在内存中为一片连续空间。
当字符串内容大于44字节时，采取raw格式，此时，描述字符串信息的redisobject和存储内容的sds在内存中分开存储，由redisobject的ptr指针维护关联关系
#### 为什么embstr的阈值是44
（1）redis使用jemalloc 作为内存分配器
（2）jemalloc用于分配的最小内存单位是64字节，embstr设计目的就是为了分配效率，所以embstr最多也就只能占一个内存单元。
embstr由redisobject和sds构成，其中redisobject需要16字节，分别是4bit对象类型，4bit底层数据结构类型，24bit lru，32bit refcount，64bit指针（取各类os指针最大值），共128bit，共16字节；sds的结构需要3字节，一字节字符串实际使用长度，一字节\0结束符，一字节字节串分配的长度，一字节flag（存储 SDS 的类型）。所以剩下64-20=44
####  为什么EMBSTR曾经的阈值是39吗？
3.2版本以前sds结构只有一种，非数据字段占据了8个字节。
后面sds分为sdshdr5(这个结构不被使用）、sdshdr8、sdshdr16、sdshdr32、sdshdr64，EMBSTR使用sdshdr8节约了6个字节，但多引入了一个flags字段占据1字节，所以相比3.2版本之前的SDS多了5个字节，
#### sds有什么用？
（1）sds包含已使用容量字段 len，相比c原生字符串需要on时间复杂度计算，sds获取内容长度只需要o1
（2）sds有预留