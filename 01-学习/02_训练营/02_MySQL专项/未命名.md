```plantuml
@startuml
title SQL 查询执行流程（区分各“器”的形状）

skinparam shadowing false
skinparam arrowColor #666
skinparam activity {
  BackgroundColor<<Connector>> #E6F7FF
  BorderColor<<Connector>> #1890FF
  BackgroundColor<<Parser>> #FFF7E6
  BorderColor<<Parser>> #FA8C16
  BackgroundColor<<Optimizer>> #F6FFED
  BorderColor<<Optimizer>> #52C41A
  BackgroundColor<<Executor>> #F0F5FF
  BorderColor<<Executor>> #2F54EB
  BackgroundColor<<Engine>> #FFF0F6
  BorderColor<<Engine>> #EB2F96
}

start

partition "Server层" {
  hexagon "连接器\n（建立连接、初始权限校验）" <<Connector>> as Conn

  if ("是否启用查询缓存？\nMySQL 5.x 有，8.0 取消") then (是)
    cloud "查询缓存\n命中则直接返回结果" as QC
    Conn --> QC
    QC --> stop
  else (否)
    roundrect "分析器\n（词法/语法分析）" <<Parser>> as Parser
    Conn --> Parser

    rectangle "优化器\n（索引选择、联表顺序、生成执行计划）" <<Optimizer>> as Opt
    Parser --> Opt

    rectangle "执行器\n（再次权限校验、调度执行计划）" <<Executor>> as Exec
    Opt --> Exec
  endif
}

partition "存储引擎层" {
  database "存储引擎（如 InnoDB）\n读取/写入数据" <<Engine>> as Engine
  Exec --> Engine
  Engine --> Exec
}

:执行器将结果返回客户端;
stop
@enduml

```

